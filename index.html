<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AI NEWS ‚Äì Die aktuellsten Nachrichten</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root{--red:#e50914}
  *{box-sizing:border-box}
  body{font-family:Outfit,system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:#fff;color:#111}
  /* Header */
  header{background:var(--red);color:#fff;padding:14px 22px;display:flex;align-items:center;justify-content:space-between}
  header h1{margin:0;text-transform:uppercase;font-size:24px;letter-spacing:.5px}
  header em{font-style:italic}
  header a.brand{color:#fff;text-decoration:none;display:inline-flex;align-items:center}
  header a.brand:focus, header a.brand:hover{opacity:.9}
  /* Nav */
  nav{display:flex;gap:10px;overflow:auto;padding:10px 16px;border-bottom:1px solid #eee;background:#fff;position:sticky;top:0;z-index:5}
  .tab{padding:8px 12px;border:none;background:#fff;border-bottom:3px solid transparent;font-weight:700;color:#555;text-decoration:none;white-space:nowrap}
  .tab.active{color:var(--red);border-color:var(--red)}
  .personalize{margin-left:auto;color:#e50914;background:transparent;border:1px solid #e50914;border-radius:999px;padding:6px 10px;cursor:pointer;font-weight:700}
  .personalize:hover{background:#ffecee}
  /* Layout */
  main{max-width:1220px;margin:18px auto;padding:0 16px}
  #loading{padding:20px;color:#666}
  /* Media */
  .media{position:relative;overflow:hidden;background:#f2f2f2}
  .media img{width:100%;height:100%;object-fit:cover;display:block}
  .hero .media{height:200px}
  .card .media{height:120px}
  .article .media{height:260px;border-radius:8px;overflow:hidden;margin:8px 0 12px}
  /* Hero (Text) */
  .hero{display:block;border-radius:12px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.08);text-decoration:none;color:inherit;margin-bottom:16px;background:#111}
  .hero .inner{padding:18px;color:#fff}
  .hero h2{margin:6px 0 0;font-size:26px}
  .hero p{margin:8px 0 0;color:#f3f3f3}
  .meta{font-size:12px;color:#666}
  .badge{font-size:10px;font-weight:800;letter-spacing:.3px;padding:2px 6px;border-radius:999px}
  .beta{background:#ffe58a;color:#111}
  /* Grid (Text-Karten) */
  .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px}
  .card{display:block;background:#fff;border-radius:12px;overflow:hidden;text-decoration:none;color:inherit;box-shadow:0 8px 24px rgba(0,0,0,.06)}
  .card .inner{padding:12px}
  .card h3{margin:4px 0 0;font-size:16px;line-height:1.25}
  .card p{margin:8px 0 0;color:#444;font-size:14px}
  /* Article page */
  .article{max-width:860px;margin:18px auto;padding:0 16px;position:relative}
  .article h1{font-size:24px;margin:8px 0}
  /* Meta-Zeile im Artikel: links Infos, rechts Button */
  .article .meta-row{
    display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;margin:6px 0 10px
  }
  .meta-left{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
  .meta-actions{margin-left:auto;position:relative;display:flex;align-items:center}
  .article .sources{margin-top:18px;padding:12px;background:#f7f7f7;border-radius:8px}
  .article .sources a{color:#e50914}
  .article-body p{margin:12px 0;line-height:1.6}
  /* >>> Keypoints b√ºndig links (ohne Einzug) <<< */
  .article-body ul{
    margin:10px 0 0 0;      /* kein linker Au√üenabstand */
    padding-left:0;         /* kein innerer Einzug */
    list-style-position:inside; /* Bullet steht in der Content-Kante */
  }
  .article-body li{margin:6px 0;line-height:1.5}
  .back{display:inline-block;margin:12px 16px;color:#e50914;text-decoration:none;font-weight:700;cursor:pointer}
  footer{padding:18px;text-align:center;color:#666}
  /* Modal Personalisieren */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;z-index:100}
  .modal{background:#fff;border-radius:12px;max-width:560px;width:92%;box-shadow:0 25px 80px rgba(0,0,0,.25);overflow:hidden}
  .modal header{background:#f8f8f8;color:#111;padding:14px 16px;display:flex;justify-content:space-between;align-items:center}
  .modal header h3{margin:0;font-size:18px}
  .modal .content{padding:14px 16px;max-height:60vh;overflow:auto}
  .modal .cats{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
  .modal .cat{display:flex;align-items:center;gap:8px;padding:8px;border:1px solid #eee;border-radius:10px}
  .modal footer{padding:12px 16px;display:flex;gap:8px;border-top:1px solid #eee;background:#fafafa}
  .btn{padding:8px 12px;border-radius:8px;border:1px solid #ddd;background:#fff;cursor:pointer;font-weight:700}
  .btn.primary{background:#e50914;color:#fff;border-color:#e50914}
  .btn.ghost{background:transparent;border-color:transparent;color:#555}
  .note{font-size:12px;color:#666}
  .fade{animation:fade .25s ease-in}
  @keyframes fade{from{opacity:.5}to{opacity:1}}

  /* Text-Filter-Button */
  .filter-btn{
    display:inline-flex;align-items:center;gap:8px;
    border:1px solid #e6e6e6;
    background:linear-gradient(180deg,#ffffff,#f6f6f6);
    border-radius:12px;padding:8px 12px;font-weight:800;
    cursor:pointer;box-shadow:0 6px 18px rgba(0,0,0,.06);
    letter-spacing:.2px
  }
  .filter-btn .icon{font-size:14px}
  .filter-btn .chev{display:inline-block;transition:transform .18s ease}
  .filter-btn[aria-expanded="true"] .chev{transform:rotate(180deg)}
  .filter-caption{font-size:12px;color:#666;margin-left:2px}
  .filter-menu{
    position:absolute;right:0;top:calc(100% + 8px);z-index:5;
    background:#fff;border:1px solid #ececec;border-radius:12px;
    box-shadow:0 18px 40px rgba(0,0,0,.12);min-width:220px;display:none;overflow:hidden
  }
  .filter-menu.open{display:block}
  .filter-item{width:100%;text-align:left;border:0;background:#fff;padding:12px 14px;cursor:pointer;display:flex;align-items:center;gap:10px}
  .filter-item:hover{background:#f9f9f9}
  .filter-item .dot{width:10px;height:10px;border-radius:999px;background:#d0d0d0}
  .filter-item.active .dot{background:var(--red)}
</style>
</head>
<body>

<header>
  <h1><a class="brand" id="brandLink" href="#/">AI <em>NEWS</em></a></h1>
</header>

<nav id="nav"></nav>

<main id="app">
  <div id="loading">Lade‚Ä¶</div>
</main>

<footer>¬© AI NEWS</footer>

<!-- Personalisieren Modal -->
<div id="personalizeBackdrop" class="modal-backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="persoTitle">
    <header>
      <h3 id="persoTitle">Kategorien personalisieren</h3>
      <button id="btnCloseModal" class="btn ghost" aria-label="Schlie√üen">‚úï</button>
    </header>
    <div class="content">
      <p>W√§hle aus, welche Kategorien in der Leiste angezeigt werden sollen.</p>
      <div id="catsList" class="cats"></div>
      <p class="note">Hinweis: Mindestens eine Kategorie muss aktiviert bleiben.</p>
    </div>
    <footer>
      <button id="btnSelectAll" class="btn">Alle ausw√§hlen</button>
      <button id="btnSelectDefault" class="btn">Standard</button>
      <button id="btnReset" class="btn">Zur√ºcksetzen</button>
      <div style="flex:1"></div>
      <button id="btnCancel" class="btn">Abbrechen</button>
      <button id="btnSave" class="btn primary">Speichern</button>
    </footer>
  </div>
</div>

<script>
/* ========= Flags ========= */
const DEMO_ONLY = true;
const MIN_ARTICLES = 10;
const DEMO_IMAGE = (id,w,h)=>`https://picsum.photos/seed/${encodeURIComponent(id)}/${w}/${h}`;

/* ========= Kategorien & Routing ========= */
const ALL_CATS = [
  {slug:"",           label:"Nachrichten",  cat:"Top"},
  {slug:"politik",    label:"Politik",      cat:"Politik"},
  {slug:"finanzen",   label:"Finanzen",     cat:"Finanzen"},
  {slug:"sport",      label:"Sport",        cat:"Sport"},
  {slug:"fussball",   label:"Fu√üball",      cat:"Fu√üball"},
  {slug:"kultur",     label:"Kultur",       cat:"Kultur"},
  {slug:"entertainment", label:"Entertainment", cat:"Entertainment"},
  {slug:"wissenschaft",  label:"Wissenschaft",  cat:"Wissenschaft"}
];
const SLUG_TO_CAT = Object.fromEntries(ALL_CATS.map(c=>[c.slug||"", c.cat]));
const CAT_TO_SLUG = Object.fromEntries(ALL_CATS.map(c=>[c.cat, c.slug||""]));
const DEFAULT_VISIBLE = ALL_CATS.map(c=>c.slug||"");

const LS_VISIBLE_KEY = "AIN_visible_slugs_v2";
const LS_LAST_SLUG   = "AIN_last_slug_v2";
const LS_TEXT_MODE   = "AIN_text_mode_v2"; // 'long' | 'medium' | 'points'
let TEXT_MODE = localStorage.getItem(LS_TEXT_MODE) || 'long';
if (TEXT_MODE === 'short') TEXT_MODE = 'medium';
function saveTextMode(mode){ TEXT_MODE = mode; localStorage.setItem(LS_TEXT_MODE, mode); }

function loadVisibleSlugs(){
  try{
    const raw = localStorage.getItem(LS_VISIBLE_KEY);
    const arr = raw ? JSON.parse(raw) : null;
    if (Array.isArray(arr) && arr.length) return arr;
  }catch{}
  return [...DEFAULT_VISIBLE];
}
function saveVisibleSlugs(slugs){ localStorage.setItem(LS_VISIBLE_KEY, JSON.stringify(slugs)); }
function getVisibleCats(){ const vis=loadVisibleSlugs(); return ALL_CATS.filter(c=>vis.includes(c.slug||"")); }

let LAST_SLUG = localStorage.getItem(LS_LAST_SLUG) || "";

/* ========= Nav ========= */
const navEl = document.getElementById('nav');
function renderNav(activeSlug){
  navEl.innerHTML = "";
  const visible = getVisibleCats();
  const slugsOnly = visible.map(v=>v.slug||"");
  if (activeSlug != null && slugsOnly.length){
    const ok = slugsOnly.includes(activeSlug);
    if (!ok){
      const target = slugsOnly[0];
      location.hash = target ? `#/${target}` : "#/";
      activeSlug = target;
    }
  }
  visible.forEach(v=>{
    const href = v.slug ? `#/${v.slug}` : "#/";
    const a = document.createElement('a');
    a.className = "tab";
    a.href = href;
    a.textContent = v.label;
    const isRoot = href==="#/";
    const match = isRoot ? (!activeSlug || activeSlug==="/" || activeSlug==="") : (v.slug===activeSlug);
    if (match) a.classList.add('active');
    navEl.appendChild(a);
  });
  const btn = document.createElement('button');
  btn.id = "btnPersonalize";
  btn.className = "personalize";
  btn.type = "button";
  btn.textContent = "+ Personalisieren";
  btn.style.marginLeft = "auto";
  btn.addEventListener('click', openPersonalize);
  navEl.appendChild(btn);
}
function setActiveTab(slug){ renderNav(slug); }

/* ========= Store ========= */
const STORE={byId:{},mode:"demo"};

/* ========= Demo-/BETA-Daten ========= */
function demoNowMinus(min){ return new Date(Date.now()-min*60000).toISOString(); }
function mkLongDemoBody(title, dek){
  const base = (dek||"") + " " + (title||"");
  const filler = [
    "Analysten bewerten die aktuelle Entwicklung differenziert und verweisen auf vergleichbare F√§lle der vergangenen Jahre.",
    "Im Mittelpunkt steht die Frage, wie sich die Beschl√ºsse kurzfristig auf Wirtschaft, Gesellschaft und Verwaltung auswirken.",
    "Beh√∂rden betonen, dass weitere Details in den kommenden Tagen folgen sollen, sobald Abstimmungen abgeschlossen sind.",
    "Branchenvertreter erwarten eine Mischung aus Chancen und Herausforderungen, insbesondere bei Umsetzung und Finanzierung.",
    "Aus Expertensicht sind Datenqualit√§t, Transparenz und klare Zust√§ndigkeiten entscheidend f√ºr den Erfolg.",
    "Mehrere Stakeholder fordern, Betroffene fr√ºhzeitig einzubinden und Feedbackschleifen verbindlich zu machen.",
    "Langfristig k√∂nnte die Ma√ünahme als Blaupause f√ºr √§hnliche Projekte in anderen Regionen dienen."
  ];
  const sentences = (base + ". " + filler.join(". ") + ".").split(". ").map(s=>s.trim()).filter(Boolean);
  const paras = [];
  let buf=[], len=0;
  for(const s of sentences){
    const add = (buf.length? " " : "") + s + ".";
    if(len + add.length > 2200 && paras.length>=5) break;
    buf.push(s + ".");
    len += add.length;
    if(buf.length>=3){ paras.push(buf.join(" ")); buf=[]; }
  }
  if(buf.length) paras.push(buf.join(" "));
  return paras.slice(0,7);
}
function mkDemo(cat,title,dek,mins,srcCount=1){
  const id = "demo-"+Math.random().toString(36).slice(2,8);
  const sources = Array.from({length:srcCount},(_,i)=>({
    source:`Demo Newswire ${i+1}`,
    title:`${title} ‚Äì Quelle ${i+1}`,
    url:`https://example.com/demo/${i+1}`
  }));
  return {
    id, title, dek,
    pub: demoNowMinus(mins),
    firstPub: demoNowMinus(mins+5),
    sources, sourceCount: sources.length,
    cat,
    image: DEMO_IMAGE(id, 1200, 630),
    imageCard: DEMO_IMAGE(id+"c", 800, 420),
    imageHero: DEMO_IMAGE(id+"h", 1200, 580),
    bodyParas: mkLongDemoBody(title, dek)
  };
}
function demoList(cat){
  const base = {
    Top: [
      ["Demo: Regierung k√ºndigt Digitalpakt an","Neuer Digitalpakt mit Fokus auf Infrastruktur, Bildung und Verwaltung.",5,3],
      ["Demo: Energiepreise sinken deutlicher","Branchenverband erwartet stabile Entwicklung im Fr√ºhling.",16,2],
      ["Demo: Bahn plant zus√§tzliche Fernz√ºge","Mehr Kapazit√§t an Reisetagen, Fokus auf internationale Verbindungen.",27,1],
      ["Demo: Bund startet F√∂rderprogramm KI","Schwerpunkt Mittelstand und Forschung.",33,2],
      ["Demo: Neue Cyberstrategie vorgestellt","Mehr Resilienz kritischer Infrastrukturen.",41,1],
      ["Demo: Wohnbaupaket beschlossen","Ziel: schnellere Genehmigungen und Neubau.",55,2],
      ["Demo: Zoll stellt Rekord bei Kontrollen auf","Mehr Aufdeckungen in Logistikzentren.",63,1],
      ["Demo: Nationale Plattform f√ºr eID","Pilotierung startet in Gro√üst√§dten.",71,2],
      ["Demo: Gesundheitsreform im Kabinett","Digitale Akten verpflichtend bis 2027.",84,1],
      ["Demo: Schulen erhalten Digitalcoaches","Ausbau von Medienkompetenz.",95,1],
      ["Demo: Gr√ºnderfonds erweitert","Startups erhalten leichter Kapitalzugang.",108,2],
      ["Demo: Breitband-Ausbau erreicht Meilenstein","95% Abdeckung im 5G-Netz.",117,2]
    ],
    Politik: [
      ["Demo: Parlament debattiert Haushaltsentwurf","Opposition fordert Nachbesserungen, Ausschuss ber√§t Investitionen.",9,2],
      ["Demo: Au√üenminister reist zu Gipfel","Gespr√§che zu Sicherheits- und Handelsthemen angek√ºndigt.",30,1],
      ["Demo: Koalitionsausschuss vertagt","Komplexe Dossiers in Arbeitsgruppen.",44,1],
      ["Demo: L√§nder fordern mehr Mittel","F√∂derale Programme sollen verstetigt werden.",52,2],
      ["Demo: Untersuchungsausschuss befragt Zeugen","Schwerpunkte Datenschutz und Vergabe.",63,1],
      ["Demo: Verfassungsgericht verhandelt Klage","Streit um Kompetenzen.",75,1],
      ["Demo: Wahlrechtsreform passiert erste H√ºrde","Sperrklauseln in der Diskussion.",82,2],
      ["Demo: Parlamentspr√§sident mahnt Einigkeit an","Appell f√ºr √ºbergreifende L√∂sungen.",91,1],
      ["Demo: Referendum √ºber Verwaltungsreform","Beteiligung √ºber digitale Kan√§le.",103,1],
      ["Demo: Fraktionen einigen sich auf Zeitplan","Plenarwochen fixiert.",115,1],
      ["Demo: Vermittlungsausschuss angesetzt","Suche nach Kompromisslinien.",127,1],
      ["Demo: EU-Rat tagt zu Binnenmarkt","Grenz√ºbergreifende Dienste im Fokus.",141,2]
    ],
    Finanzen: [
      ["Demo: Inflation f√§llt st√§rker als erwartet","√ñkonomen sehen Spielraum f√ºr Zinssenkungen, M√§rkte reagieren positiv.",7,3],
      ["Demo: Tech-Konzern √ºbertrifft Prognosen","Umsatz im Cloud-Gesch√§ft w√§chst, Aktie legt zu.",24,1],
      ["Demo: DAX n√§hert sich Rekordhoch","Industriewerte im Plus.",31,2],
      ["Demo: EZB signalisiert Kurs halten","Zinsgipfel abgewartet.",46,1],
      ["Demo: IPO belebt Prim√§rmarkt","√úberzeichnung binnen Stunden.",55,2],
      ["Demo: Startup sammelt Serie-B","Skalierung in EU geplant.",64,1],
      ["Demo: Bankenverband warnt vor Risikomodellen","Stresstests ausgeweitet.",73,1],
      ["Demo: Roh√∂lpreis sinkt","Terminkurven drehen in Contango.",88,2],
      ["Demo: Private Equity kauft Mittelst√§ndler","Digitalisierungsoffensive angek√ºndigt.",97,1],
      ["Demo: Anleihem√§rkte stabil","Spread-Kompression in Peripherie.",106,1],
      ["Demo: Kryptomarkt volatil","Altcoins im Fokus.",118,1],
      ["Demo: Devisenmarkt ruhig","Carry-Trades profitieren.",129,1]
    ],
    Sport: [
      ["Demo: Nationalteam erreicht Finale","Spannendes Spiel mit sp√§tem Tor ‚Äì Trainer lobt Moral.",8,2],
      ["Demo: √úberraschung im Basketball","Underdog gewinnt ausw√§rts ‚Äì Serie bleibt offen.",31,1],
      ["Demo: Marathon mit neuem Streckenrekord","Pace-Strategie geht auf.",45,1],
      ["Demo: Tennis: Favoritin im Halbfinale","Aufschlagquote √ºberzeugt.",57,1],
      ["Demo: Radsport: Bergetappe entschieden","Attacke am letzten Anstieg.",66,1],
      ["Demo: Handball: Keeper √ºberragt","Siebenmeterquote stark.",74,1],
      ["Demo: Eishockey: Shutout im Derby","Defensive steht sicher.",86,1],
      ["Demo: Leichtathletik: U20 mit Medaillen","Nachwuchs √ºberzeugt.",99,1],
      ["Demo: Schwimmen: Nationalrekord √ºber 200m","Negative-Split-Taktik.",112,1],
      ["Demo: Volleyball: Comeback nach 0:2","Blockarbeit zahlt sich aus.",124,1],
      ["Demo: Tischtennis: Sieg im Entscheidungsdurchgang","Platzierungsrunde offen.",135,1],
      ["Demo: Wintersport: Trainingslager er√∂ffnet","Materialtests im Fokus.",146,1]
    ],
    Fu√üball: [
      ["Demo: Toptransfer kurz vor Abschluss","Verein best√§tigt fortgeschrittene Gespr√§che, Medizincheck steht an.",6,2],
      ["Demo: Trainer verl√§ngert Vertrag","Langfristige Planung soll Talente f√∂rdern.",29,1],
      ["Demo: UCL-Auslosung bringt Kracher","Faninteresse riesig.",41,1],
      ["Demo: Abwehrchef kehrt ins Training zur√ºck","Reha verl√§uft planm√§√üig.",52,1],
      ["Demo: Talentsichtung in Akademie","Scouting erweitert Netzwerk.",63,1],
      ["Demo: Ticketrekord beim Heimspiel","Vereinsinterne Bestmarke.",71,1],
      ["Demo: VAR-Debatte flammt auf","Verb√§nde k√ºndigen Austausch an.",83,1],
      ["Demo: Neuer Trikotsponsor vorgestellt","Mehr Engagement im Jugendbereich.",95,1],
      ["Demo: Pokal-Halbfinale terminiert","Sicherheitskonzept abgestimmt.",106,1],
      ["Demo: Spielplanverdichtung kritisiert","Belastungssteuerung im Gespr√§ch.",118,1],
      ["Demo: Jugendteam gewinnt Turnier","Durchmarsch ohne Gegentor.",129,1],
      ["Demo: Stadionmodernisierung genehmigt","Kapazit√§tserh√∂hung geplant.",141,1]
    ],
    Kultur: [
      ["Demo: Neues Museum er√∂ffnet","Interaktive Formate ‚Äì Besucherandrang zur Er√∂ffnung.",11,1],
      ["Demo: Festivalprogramm steht","Kuratorisches Thema: Wandel.",22,1],
      ["Demo: Opernpremiere gefeiert","Standing Ovations zum Finale.",34,1],
      ["Demo: Theater erh√§lt Preis","Experimentelle B√ºhne geehrt.",47,1],
      ["Demo: Literaturpreis vergeben","Deb√ºt √ºberzeugt Jury.",58,1],
      ["Demo: Ausstellung verl√§ngert","Besucherzahlen √ºber Erwartungen.",69,1],
      ["Demo: Restaurierung abgeschlossen","Ikonisches Werk kehrt zur√ºck.",81,1],
      ["Demo: Filmarchiv digitalisiert Best√§nde","Zugang f√ºr Forschung erleichtert.",95,1],
      ["Demo: Philharmonie k√ºndigt Tournee an","Neue Programme geplant.",107,1],
      ["Demo: Designbiennale mit Rekord","Internationale Beteiligung w√§chst.",119,1],
      ["Demo: Jazzfestival startet","Open-Air-Konzerte angek√ºndigt.",131,1],
      ["Demo: Stadt richtet Kulturfonds ein","F√∂rderlinien angepasst.",142,1]
    ],
    Entertainment: [
      ["Demo: Blockbuster startet stark","Premierenwochenende √ºbertrifft Erwartungen ‚Äì Kritiken gemischt.",14,2],
      ["Demo: Serie verl√§ngert um Staffel","Showrunner best√§tigt Drehstart.",26,1],
      ["Demo: Musikpreis-Nominierungen ver√∂ffentlicht","Vielf√§ltiges Feld.",38,1],
      ["Demo: Streamingdienst mit Rekordabo","Neues Abo-Modell zieht.",51,1],
      ["Demo: Regisseur k√ºndigt Sci-Fi an","Dreharbeiten im Herbst.",63,1],
      ["Demo: Biopic feiert Premiere","Standing Ovations in Cannes.",75,1],
      ["Demo: Spielverfilmung best√§tigt","Drehbuchautor engagiert.",88,1],
      ["Demo: Chartst√ºrmer erreicht Platin","Kollaboration schl√§gt ein.",99,1],
      ["Demo: Award-Show bekommt neuen Host","Publikum reagiert positiv.",110,1],
      ["Demo: Animationsstudio mit Kurzfilmreihe","K√ºnstlerische Experimente.",121,1],
      ["Demo: Comedy-Special angek√ºndigt","Tourdaten folgen.",132,1],
      ["Demo: Festival setzt auf Nachhaltigkeit","Green-Stages geplant.",143,1]
    ],
    Wissenschaft: [
      ["Demo: Durchbruch bei Batterien","Neue Kathodenstruktur erh√∂ht Zyklenzahl ‚Äì Pilotprojekt angek√ºndigt.",10,2],
      ["Demo: Teleskop entdeckt Exoplaneten","Daten best√§tigen Transit.",22,1],
      ["Demo: mRNA-Plattform erweitert","Anwendung in Onkologie.",34,1],
      ["Demo: Quantenchip stabiler","Fehlerraten sinken signifikant.",46,1],
      ["Demo: Klima-Studie zu Extremwetter","Attributionsforschung pr√§ziser.",58,1],
      ["Demo: Fusionsforschung erzielt Rekord","Energieertrag verbessert.",70,1],
      ["Demo: CRISPR-Variante pr√§ziser","Off-Target-Effekte reduziert.",81,1],
      ["Demo: Meeresspiegel-Analyse aktualisiert","Satellitendaten verdichten Trends.",93,1],
      ["Demo: Material entdeckt mit Supraleitung","Niedrige Druckbedingungen ausreichend.",104,1],
      ["Demo: Robotik in der Pflege erprobt","Assistenzsysteme im Einsatz.",116,1],
      ["Demo: Mathematikpreis vergeben","Neue Beweise f√ºr alte Vermutungen.",128,1],
      ["Demo: Raumfahrt: Sonde erreicht Zielorbit","Erste Messreihen starten.",139,1]
    ]
  }[cat] || [];
  return base.map(([t,d,m,s])=>mkDemo(cat,t,d,m,s));
}
const DEMO = {
  Top: demoList("Top"),
  Politik: demoList("Politik"),
  Finanzen: demoList("Finanzen"),
  Sport: demoList("Sport"),
  Fu√üball: demoList("Fu√üball"),
  Kultur: demoList("Kultur"),
  Entertainment: demoList("Entertainment"),
  Wissenschaft: demoList("Wissenschaft")
};

/* ========= Helfer ========= */
function fmtDate(iso){
  if(!iso) return "";
  const d = new Date(iso);
  try{
    return new Intl.DateTimeFormat('de-DE',{
      weekday:'short', day:'2-digit', month:'2-digit', year:'numeric',
      hour:'2-digit', minute:'2-digit'
    }).format(d);
  }catch{ return d.toLocaleString('de-DE'); }
}
function escapeHtml(s){ return (s||'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
function trunc(s,n){ s=s||''; return s.length>n ? s.slice(0,n-1)+'‚Ä¶' : s; }

/* ========= Rendering-Helfer ========= */
function makeHero(a){
  const media = a.imageHero ? `<div class="media"><img loading="lazy" src="${a.imageHero}" alt="${escapeHtml(a.title)}"></div>` : "";
  return `
  <a class="hero fade" href="#/artikel/${a.id}">
    ${media}
    <div class="inner">
      <div class="meta" style="color:#bbb">
        <span>${fmtDate(a.firstPub || a.pub)} ‚Ä¢ Aggregiert aus ${a.sourceCount|| (a.sources?.length||1)} Quelle${(a.sourceCount|| (a.sources?.length||1))>1?'n':''}</span>
        <span class="badge beta">BETA</span>
      </div>
      <h2>${escapeHtml(a.title)}</h2>
      <p>${escapeHtml(trunc(a.dek,220))}</p>
    </div>
  </a>`;
}
function makeCard(a){
  const media = a.imageCard ? `<div class="media"><img loading="lazy" src="${a.imageCard}" alt="${escapeHtml(a.title)}"></div>` : "";
  return `
  <a class="card fade" href="#/artikel/${a.id}">
    ${media}
    <div class="inner">
      <div class="meta">
        <span>${fmtDate(a.firstPub || a.pub)} ‚Ä¢ Aggregiert aus ${a.sourceCount|| (a.sources?.length||1)} Quelle${(a.sourceCount|| (a.sources?.length||1))>1?'n':''}</span>
        <span class="badge beta">BETA</span>
      </div>
      <h3>${escapeHtml(a.title)}</h3>
      <p>${escapeHtml(trunc(a.dek,180))}</p>
    </div>
  </a>`;
}

/* ========= ‚ÄûMittel‚Äú-Zusammenfassung (extraktiv) ========= */
const STOP_DE = new Set(("der,die,das,und,oder,aber,im,in,an,am,auf,aus,mit,f√ºr,ohne,um,zu,beim,vom,von,dem,den,des,ein,eine,einer,einem,eines,ist,sind,war,waren,wird,werden,hat,haben,wurde,auch,nicht,noch,schon,so,wie,als,mehr,weniger,√ºber,unter,zwischen,gegen,nach,vor,seit,bis,bei,man,es,wir,ihr,er,sie,ihn,ihm,uns,eu,ihrer,deren,am,beide,alle,jede,kein,keine,keinen").split(","));
function tokens(s){
  return (s||"").toLowerCase()
    .replace(/[^a-z0-9√§√∂√º√ü ]/gi," ")
    .split(/\s+/).filter(t=>t && t.length>2 && !STOP_DE.has(t));
}
function jaccardWords(a,b){
  const A=new Set(tokens(a)), B=new Set(tokens(b));
  const inter=[...A].filter(x=>B.has(x)).length;
  const uni=new Set([...A,...B]).size||1;
  return inter/uni;
}
function splitSentences(paras){
  const text = (paras||[]).join(" ").replace(/\s+/g," ").trim();
  if(!text) return [];
  return text.split(/(?<=[.!?])\s+/).map(s=>s.trim()).filter(Boolean);
}
function scoreSentence(s, idx, total){
  const len = s.length;
  const target=140;
  const lengthScore = Math.max(0, 1 - Math.abs(len-target)/target);
  const positionScore = 1 - (idx/(total||1))*0.5;
  const digitScore = /\d/.test(s) ? 0.12 : 0;
  const dashScore = /[:‚Äì\-]/.test(s) ? 0.06 : 0;
  return lengthScore*0.6 + positionScore*0.22 + digitScore + dashScore;
}
function summarizeMedium(paras, targetChars=900, maxSentences=8, simThreshold=0.6){
  const sents = splitSentences(paras);
  const scored = sents.map((s,i)=>({s, i, sc: scoreSentence(s,i,sents.length)}))
                      .sort((a,b)=>b.sc-a.sc);
  const chosen=[];
  let totalLen=0;
  for(const cand of scored){
    const redundant = chosen.some(x=>jaccardWords(x.s, cand.s) >= simThreshold);
    if(redundant) continue;
    if(totalLen + cand.s.length + 1 > targetChars && chosen.length>=3) continue;
    chosen.push(cand);
    totalLen += cand.s.length + 1;
    if(chosen.length>=maxSentences) break;
  }
  chosen.sort((a,b)=>a.i-b.i);
  const perPara = Math.max(3, Math.ceil(chosen.length/2));
  const out=[];
  for(let i=0;i<chosen.length;i+=perPara){
    out.push(chosen.slice(i,i+perPara).map(x=>x.s).join(" "));
  }
  return out;
}

/* ========= Text-Ansicht (Filter) ========= */
function renderArticleBodyHTML(a, mode){
  const paras = a.bodyParas && a.bodyParas.length ? a.bodyParas : [a.dek||""];
  if(mode === 'medium'){
    const mids = summarizeMedium(paras, 900, 8, 0.6);
    const effective = mids.length ? mids : [paras[0]||""];
    return `<div class="article-body">${effective.map(p=>`<p>${escapeHtml(p)}</p>`).join("")}</div>`;
  }
  if(mode === 'points'){
    const ptsFull = splitSentences(paras);
    const picked=[]; 
    for(const s of ptsFull){
      let dup=false;
      for(const p of picked){ if(jaccardWords(p,s)>0.6){ dup=true; break; } }
      if(!dup) picked.push(s);
      if(picked.length>=7) break;
    }
    return `<div class="article-body"><ul>${picked.map(p=>`<li>${escapeHtml(p)}</li>`).join("")}</ul></div>`;
  }
  return `<div class="article-body">${paras.map(p=>`<p>${escapeHtml(p)}</p>`).join("")}</div>`;
}
function buildFilterMenu(current){
  return `
    <div class="filter-menu" id="filterMenu" role="menu" aria-hidden="true">
      <button class="filter-item ${current==='long'?'active':''}" data-mode="long" role="menuitem">
        <span class="dot"></span><span>Lang (Standard)</span>
      </button>
      <button class="filter-item ${current==='medium'?'active':''}" data-mode="medium" role="menuitem">
        <span class="dot"></span><span>Mittel (gek√ºrzt)</span>
      </button>
      <button class="filter-item ${current==='points'?'active':''}" data-mode="points" role="menuitem">
        <span class="dot"></span><span>Keypoints</span>
      </button>
    </div>`;
}

/* ========= Rendering Liste/Artikel ========= */
let renderCountInitial = 12, renderStep = 12;

function renderList(cat, arts){
  const app=document.getElementById('app');
  if(!arts||!arts.length){ app.innerHTML=`<p style="padding:16px;color:#666">Keine Artikel gefunden.</p>`; return; }

  if (arts.length < MIN_ARTICLES){
    const padded = arts.slice();
    while (padded.length < MIN_ARTICLES) padded.push(arts[padded.length % arts.length]);
    arts = padded;
  }
  STORE.byId=Object.fromEntries(arts.map(a=>[a.id,a]));

  const top=arts[0];
  const hero = makeHero(top);

  const rest=arts.slice(1);
  const firstChunk=rest.slice(0,renderCountInitial-1).map(makeCard).join('');
  const moreLeft=rest.length-(renderCountInitial-1);

  app.innerHTML = `${hero}<div id="grid" class="grid">${firstChunk}</div>${moreLeft>0?`<button id="loadmore" class="btn">Mehr laden (${moreLeft})</button>`:''}`;

  const btn=document.getElementById('loadmore');
  if(btn){
    btn.addEventListener('click',()=>{
      const grid=document.getElementById('grid');
      const next=rest.slice(renderCountInitial-1,renderCountInitial-1+renderStep).map(makeCard).join('');
      grid.insertAdjacentHTML('beforeend',next);
      renderCountInitial+=renderStep;
      const remaining=rest.length-(renderCountInitial-1);
      if(remaining>0) btn.textContent=`Mehr laden (${remaining})`; else btn.remove();
    });
  }
}

async function renderCategory(cat,slug){
  LAST_SLUG=slug||""; localStorage.setItem(LS_LAST_SLUG, LAST_SLUG);
  setActiveTab(LAST_SLUG);
  const app=document.getElementById('app');
  app.innerHTML=`<div id="loading">Lade Artikel‚Ä¶</div>`;

  const demoListArr = (DEMO[cat] || DEMO.Top) ?? [];
  const arts = demoListArr.slice().sort((a,b)=>Date.parse(b.pub)-Date.parse(a.pub));
  renderList(cat, arts);
}

function attachBackHandler(){
  const link = document.getElementById('backLink');
  if(!link) return;
  link.addEventListener('click', handleBack);
}
function handleBack(e){
  e.preventDefault();
  const fallback = LAST_SLUG ? `#/${LAST_SLUG}` : "#/";
  const before = location.hash;
  let navigated = false;
  const onHash = ()=>{ navigated = true; window.removeEventListener('hashchange', onHash); };
  window.addEventListener('hashchange', onHash, {once:true});

  if (history.length > 1) history.back();
  setTimeout(()=>{ if(!navigated || location.hash === before){ location.hash = fallback; } }, 200);
}

function attachFilterHandlers(a){
  const btn = document.getElementById('filterBtn');
  const menu = document.getElementById('filterMenu');
  const bodyWrap = document.getElementById('articleBodyContainer');
  if(!btn || !menu || !bodyWrap) return;

  bodyWrap.innerHTML = renderArticleBodyHTML(a, TEXT_MODE);
  const label = document.getElementById('filterCaption');
  if (label) label.textContent = (TEXT_MODE==='long'?'Lang':TEXT_MODE==='medium'?'Mittel':'Keypoints');

  const closeMenu = ()=>{ menu.classList.remove('open'); menu.setAttribute('aria-hidden','true'); btn.setAttribute('aria-expanded','false'); };
  const openMenu = ()=>{ menu.classList.add('open'); menu.setAttribute('aria-hidden','false'); btn.setAttribute('aria-expanded','true'); };

  btn.addEventListener('click', (e)=>{
    e.stopPropagation();
    if(menu.classList.contains('open')) closeMenu(); else openMenu();
  });
  document.addEventListener('click', (e)=>{ if(!menu.contains(e.target) && e.target!==btn) closeMenu(); });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeMenu(); });

  menu.querySelectorAll('.filter-item').forEach(item=>{
    item.addEventListener('click', ()=>{
      const mode = item.getAttribute('data-mode');
      if(!mode) return;
      saveTextMode(mode);
      menu.querySelectorAll('.filter-item').forEach(i=>i.classList.remove('active'));
      item.classList.add('active');
      if (label) label.textContent = (mode==='long'?'Lang':mode==='medium'?'Mittel':'Keypoints');
      bodyWrap.innerHTML = renderArticleBodyHTML(a, TEXT_MODE);
      closeMenu();
    });
  });
}

async function renderArticle(id){
  setActiveTab(LAST_SLUG);
  const app=document.getElementById('app');
  app.innerHTML=`<div id="loading">Lade Artikel‚Ä¶</div>`;

  let a = STORE.byId[id];

  if(!a){
    let found=null, foundCat='Top';
    for (const [cat, arr] of Object.entries(DEMO)){
      found = (arr||[]).find(x=>x.id===id);
      if(found){ foundCat=cat; break; }
    }
    if(found){
      a = found;
      LAST_SLUG = CAT_TO_SLUG[foundCat] || "";
      localStorage.setItem(LS_LAST_SLUG, LAST_SLUG);
      STORE.byId[id] = a;
      setActiveTab(LAST_SLUG);
    }
  }

  if(!a){ app.innerHTML=`<p style="padding:16px;color:#666">Artikel nicht gefunden.</p>`; return; }

  const sources=(a.sources||[]).map(s=>`
    <li>${escapeHtml(s.source)}: <a href="${s.url}" target="_blank" rel="noopener">${escapeHtml(s.title)}</a></li>
  `).join('');
  const count = a.sourceCount || (a.sources?.length||1);

  const cover = a.image
    ? `<div class="media"><img loading="lazy" src="${a.image}" alt="${escapeHtml(a.title)}"></div>`
    : "";

  const metaRow = `
    <div class="meta-row">
      <div class="meta-left">
        <span class="meta">Ver√∂ffentlicht: ${fmtDate(a.firstPub || a.pub)} ‚Ä¢ Aggregiert aus ${count} Quelle${count>1?'n':''}</span>
        <span class="badge beta">BETA</span>
      </div>
      <div class="meta-actions">
        <button class="filter-btn" id="filterBtn" type="button" aria-haspopup="true" aria-expanded="false" title="Textansicht">
          <span class="icon">üìù</span><span>Text</span>
          <span class="filter-caption" id="filterCaption"> ${TEXT_MODE==='long'?'Lang':TEXT_MODE==='medium'?'Mittel':'Keypoints'}</span>
          <span class="chev">‚ñæ</span>
        </button>
        ${buildFilterMenu(TEXT_MODE)}
      </div>
    </div>
  `;

  app.innerHTML=`
    <a class="back" id="backLink" href="#/">‚Üê Zur√ºck</a>
    <section class="article">
      ${metaRow}
      <h1>${escapeHtml(a.title)}</h1>
      ${cover}
      <div id="articleBodyContainer"></div>
      <div class="sources">
        <h3>Quellen</h3>
        <ul>${sources}</ul>
      </div>
    </section>`;
  attachBackHandler();
  attachFilterHandlers(a);
}

/* ========= Router ========= */
function getRoute(){
  const hash=(location.hash||"#/").replace(/^#/,"");
  const parts=hash.split("/").filter(Boolean);
  if(!parts.length) return {name:"category",cat:"Top",slug:""};
  if(parts[0]==="artikel") return {name:"article",id:parts[1]||""};
  const slug=parts[0];
  return {name:"category",cat:SLUG_TO_CAT[slug]||"Top",slug};
}
async function route(){
  const r=getRoute();
  if (navEl.childElementCount===0) renderNav(r.name==="article" ? LAST_SLUG : (r.slug||""));
  if(r.name==="article") return renderArticle(r.id);
  return renderCategory(r.cat,r.slug);
}
window.addEventListener('hashchange',route);
renderNav(LAST_SLUG);
route();

/* ========= Personalisieren Modal ========= */
const backdrop = document.getElementById('personalizeBackdrop');
const catsList = document.getElementById('catsList');
const btnCloseModal = document.getElementById('btnCloseModal');
const btnCancel = document.getElementById('btnCancel');
const btnSave = document.getElementById('btnSave');
const btnSelectAll = document.getElementById('btnSelectAll');
const btnSelectDefault = document.getElementById('btnSelectDefault');
const btnReset = document.getElementById('btnReset');

function openPersonalize(){
  catsList.innerHTML = "";
  const selected = new Set(loadVisibleSlugs());
  ALL_CATS.forEach(c=>{
    const id = `ck_${c.slug||'root'}`;
    const wrap = document.createElement('label');
    wrap.className = "cat";
    wrap.innerHTML = `
      <input type="checkbox" id="${id}" ${selected.has(c.slug||"")?'checked':''} data-slug="${c.slug}">
      <span>${c.label}</span>
    `;
    catsList.appendChild(wrap);
  });
  backdrop.style.display = "flex";
  backdrop.setAttribute('aria-hidden','false');
}
function closePersonalize(){
  backdrop.style.display = "none";
  backdrop.setAttribute('aria-hidden','true');
}
function getModalSelection(){
  const boxes = catsList.querySelectorAll('input[type=checkbox]');
  const sel = [];
  boxes.forEach(b=>{ if(b.checked) sel.push(b.getAttribute('data-slug')||""); });
  return sel;
}
btnCloseModal.addEventListener('click', closePersonalize);
btnCancel.addEventListener('click', closePersonalize);
backdrop.addEventListener('click', (e)=>{ if(e.target===backdrop) closePersonalize(); });

btnSelectAll.addEventListener('click', ()=>{
  catsList.querySelectorAll('input[type=checkbox]').forEach(b=>b.checked=true);
});
btnSelectDefault.addEventListener('click', ()=>{
  const def = new Set(DEFAULT_VISIBLE);
  catsList.querySelectorAll('input[type=checkbox]').forEach(b=>{
    const slug = b.getAttribute('data-slug')||"";
    b.checked = def.has(slug);
  });
});
btnReset.addEventListener('click', ()=>{
  localStorage.removeItem(LS_VISIBLE_KEY);
  const def = new Set(DEFAULT_VISIBLE);
  catsList.querySelectorAll('input[type=checkbox]').forEach(b=>{
    const slug = b.getAttribute('data-slug')||"";
    b.checked = def.has(slug);
  });
});
btnSave.addEventListener('click', ()=>{
  const sel = getModalSelection();
  if (!sel.length){
    alert("Mindestens eine Kategorie muss aktiviert bleiben.");
    return;
  }
  saveVisibleSlugs(sel);
  const current = getRoute();
  const activeSlug = current.name==="article" ? LAST_SLUG : (current.slug||"");
  renderNav(activeSlug);
  if (!sel.includes(activeSlug)){
    const target = sel[0] || "";
    location.hash = target ? `#/${target}` : "#/";
  }
  closePersonalize();
});
document.addEventListener('keydown', (e)=>{
  if (e.key === 'Escape' && backdrop.style.display === 'flex') closePersonalize();
});

/* --- Hotfix: Klick-Verhalten --- */
(function(){
  document.addEventListener('click', (e) => {
    const a = e.target.closest('a.tab');
    if (!a) return;
    if (a.classList.contains('active')) {
      e.preventDefault();
      if (typeof route === 'function') route();
    }
  });
  const brand = document.getElementById('brandLink');
  if (brand) {
    brand.addEventListener('click', (e)=>{
      e.preventDefault();
      if (location.hash === '' || location.hash === '#' || location.hash === '#/') {
        if (typeof route === 'function') route();
      } else {
        location.hash = '#/';
      }
    });
  }
  window.addEventListener('hashchange', () => {
    const h = (location.hash||'').replace(/^#/,'');
    const parts = h.split('/').filter(Boolean);
    if (parts[0] === 'artikel' && typeof STORE !== 'undefined' && STORE && !STORE.byId[parts[1]]) {
      if (typeof getRoute === 'function' && typeof renderCategory === 'function') {
        const slug = (typeof LAST_SLUG !== 'undefined') ? LAST_SLUG : '';
        const catMap = (typeof SLUG_TO_CAT !== 'undefined') ? SLUG_TO_CAT : {};
        const cat = catMap[slug] || 'Top';
        renderCategory(cat, slug);
      }
    }
  });
  document.addEventListener('click', (e)=>{
    const a = e.target.closest('a[href^="#/artikel/"]');
    if (!a) return;
    const href = a.getAttribute('href') || '';
    if (href === (location.hash || '')) {
      e.preventDefault();
      if (typeof route === 'function') route();
    }
  });
})();
</script>
</body>
</html>
